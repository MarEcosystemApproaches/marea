meta <- obj$meta
View(obj)
usethis::use_data(glorys_bottom_temperature, overwrite = TRUE)
usethis::use_data(grey_seals, overwrite = TRUE)
usethis::use_data(grey_seals_2021, overwrite = TRUE)
usethis::use_data(mei, overwrite = TRUE)
usethis::use_data(nao, overwrite = TRUE)
usethis::use_data(npgo, overwrite = TRUE)
usethis::use_data(oni, overwrite = TRUE)
usethis::use_data(pdo, overwrite = TRUE)
usethis::use_data(soi, overwrite = TRUE)
load("~/GitHub/marea/data/food_habits.rda")
fh_ea <- new('ea_data', data = food_habits)
fh <-  food_habits %>% mutate(year = format(as.Date(SDATE), '%Y'))
fh <-  food_habits %>% mutate(year = format(as.Date(food_habits$SDATE), '%Y'))
as.Date(food_habits$SDATE)
as.Date(food_habits$SDATE, '%d-%b-%Y')
fh <-  food_habits %>% mutate(year = format(as.Date(food_habits$SDATE, '%d-%b-%Y'), '%Y'))
fh_ea <- new('ea_data', data = fh)
fh_ea <- new('ea_data', data = fh, value = 'FSHNO')
fh_ea <- as_ea_data(fh, value = 'FSHNO')
fh <-  food_habits %>% mutate(year = as.numeric(format(as.Date(food_habits$SDATE, '%d-%b-%Y'), '%Y')))
fh_ea <- as_ea_data(fh, value = 'FSHNO')
View(fh_ea)
food_habits <- fh_ea
usethis::use_data(food_habits, overwrite = TRUE)
devtools::document()
devtools::document()
devtools::check()
library(marea)
str(marea::grey_seals)
HalFSAR <- readRDS("C:/Users/mcmahonm/Downloads/HalFSAR.rds")
View(HalFSAR)
unique(HalFSAR$panel.category, HalFSAR$ts.name)
unique(HalFSAR$panel.category)
unique(HalFSAR$ts.name)
str(marea::grey_seals)
View(HalFSAR)
str(HalFSAR)
str(marea::grey_seals)
str(marea::azmp_bottom_temperature)
str(marea::amo)
str(marea::ao)
str(marea::glorys_bottom_temperature)
str(marea::mei
)
str(marea::nao)
str(marea::npgo
)
str(marea::oni)
str(marea::pdo)
str(marea::soi)
str(marea::amo)
str(marea::ao)
str(marea::azmp_bottom_temperature)
str(marea::grey_seals)
str(marea::mei)
str(marea::food_habits)
library(marea)
library(dplyr)
marea::food_habits |> filter(STRAT=455)
unique(marea::azmp_bottom_temperature@data$region)
plot(marea::azmp_bottom_temperature)
str(marea::azmp_bottom_temperature)
generate_AI_package_txt(package_folder = "c:/git/MarEcosystemApproaches/marea/")
str(HalFSAR)
print(head(HalFSAR,20))
print(tail(HalFSAR,20))
tt<- halibut_fsar@data[halibut_fsar@data$panel.category=="Catch" & halibut_fsar@data$pts.name=="CanadaTotal",]
tt<- HalFSAR@data[HalFSAR@data$panel.category=="Catch" & HalFSAR@data$pts.name=="CanadaTotal",]
head(marea::azmp_bottom_temperature)
str(marea::azmp_bottom_temperature)
head(marea::azmp_bottom_temperature@data)
tail(marea::azmp_bottom_temperature@data)
subset_ea_data <- function(x, field, value) {
if (!inherits(x, "ea_data")) {
stop("Input object must be of class 'ea_data'")
}
# Extract the slot data
dat <- x@data
# Ensure the field exists
if (!field %in% colnames(dat)) {
stop(sprintf("Field '%s' not found in ea_data@data", field))
}
# Subset the tibble
dat_sub <- dat[dat[[field]] == value, ]
# If nothing matches, warn and return empty ea_data
if (nrow(dat_sub) == 0) {
warning("No records matched. Returning object with empty data slot.")
}
# Create new ea_data object for return
methods::new("ea_data", meta = x@meta, data = dat_sub)
}
obj_4X <- subset_ea_data(marea::azmp_bottom_temperature, "region", "4X")
plot(obj_4X)
plot(marea::azmp_bottom_temperature)
subset_ea_data <- function(x, ...) {
if (!inherits(x, "ea_data")) {
stop("Input object must be of class 'ea_data'")
}
dat <- x@data
filters <- list(...)
if (length(filters) == 0) {
stop("Provide at least one field/value pair to filter by.")
}
# Ensure fields exist
for (f in names(filters)) {
if (!f %in% colnames(dat)) {
stop(sprintf("Field '%s' not found in ea_data@data", f))
}
}
# Build logical filtering vector
keep <- rep(TRUE, nrow(dat))
for (f in names(filters)) {
keep <- keep & dat[[f]] == filters[[f]]
}
dat_sub <- dat[keep, ]
if (nrow(dat_sub) == 0) {
warning("No records matched. Returning object with empty data slot.")
}
methods::new("ea_data", meta = x@meta, data = dat_sub)
}
obj_4X_2020 <- subset_ea_data(marea::azmp_bottom_temperature, region = "4X", year = 2020)
plot(obj_4X_2020 )
str(marea::food_habits)
food_habits <- subset_ea_data(marea::azmp_bottom_temperature, DATASOURCE = "GS", STRAT  = 455, SPEC=10)
food_habits <- subset_ea_data(marea::food_habits, DATASOURCE = "GS", STRAT  = 455, SPEC=10)
plot(food_habits)
halibut_fsar<-ea_data(
data=HalFSAR,
value_col="ts.value",
data_type= "stock",
location_descriptor = "NAFO3nops4vswx5zc",
region = "Maritimes",
units="variable")
halibut_catch<-halibut_fsar[halibut_fsar@data$panel.category=="Catch" &
halibut_fsar@data$ts.name=="CanadaTotal"]
plot(halibut_catch)
View(HalFSAR)
str(HalFSAR)
unique(HalFSAR$ts.name)
HalFSAR <- readRDS("C:/Users/mcmahonm/Downloads/HalFSAR.rds")
library(dplyr)
library(tidyr)
HalFSAR2 <- HalFSAR %>%
mutate(
# Extract base name using regex for known patterns, otherwise retain ts.name
base = case_when(
str_detect(ts.name, "^HSobs") ~ "HSobs",
str_detect(ts.name, "^HSpred") ~ "HSpred",
str_detect(ts.name, "^HSproj") ~ "HSproj",
str_detect(ts.name, "^Ut") ~ "Ut",
str_detect(ts.name, "^Mt") ~ "Mt",
TRUE ~ ts.name
)
)
library(dplyr)
library(tidyr)
HalFSAR2 <- HalFSAR %>%
mutate(
# Extract base name using regex for known patterns, otherwise retain ts.name
base = case_when(
str_detect(ts.name, "^HSobs") ~ "HSobs",
str_detect(ts.name, "^HSpred") ~ "HSpred",
str_detect(ts.name, "^HSproj") ~ "HSproj",
str_detect(ts.name, "^Ut") ~ "Ut",
str_detect(ts.name, "^Mt") ~ "Mt",
TRUE ~ ts.name
)
)
library(stringr)
HalFSAR2 <- HalFSAR %>%
mutate(
# Extract base name using regex for known patterns, otherwise retain ts.name
base = case_when(
str_detect(ts.name, "^HSobs") ~ "HSobs",
str_detect(ts.name, "^HSpred") ~ "HSpred",
str_detect(ts.name, "^HSproj") ~ "HSproj",
str_detect(ts.name, "^Ut") ~ "Ut",
str_detect(ts.name, "^Mt") ~ "Mt",
TRUE ~ ts.name
)
)
head(HalFSAR)
# Spread (widen) the data so each year/base is one row and columns for variants
HalFSAR_wide <- HalFSAR2 %>%
select(year, base, ts.name, ts.value) %>%
mutate(
variant = case_when(
base %in% other_names ~ "ts.name",
ts.name == base ~ "ts.name",
str_detect(ts.name, "low$") ~ "low",
str_detect(ts.name, "high$") ~ "high",
TRUE ~ NA_character_
)
) %>%
filter(!is.na(variant)) %>%
pivot_wider(names_from = variant, values_from = ts.value) %>%
select(year, base, main, low, high)
HalFSAR <- readRDS("C:/Users/mcmahonm/Downloads/HalFSAR.rds")
has_low_high <- c(
"HSpred", "HSproj", "Ut", "Mt"   # add or remove as needed
)
HalFSAR_wide <- HalFSAR %>%
# Extract base name
mutate(
base = case_when(
# For those with explicit low/high
str_detect(ts.name, "^HSpred") ~ "HSpred",
str_detect(ts.name, "^HSproj") ~ "HSproj",
str_detect(ts.name, "^Ut")     ~ "Ut",
str_detect(ts.name, "^Mt")     ~ "Mt",
# For all others, keep original name
TRUE ~ ts.name
)
) %>%
group_by(panel.category, year, base) %>%
pivot_wider(
names_from = ts.name,
values_from = ts.value
) %>%
ungroup() %>%
mutate(
low = case_when(
base %in% has_low_high & !is.na( get(paste0(base, "low")) ) ~ get(paste0(base, "low")),
TRUE ~ NA_real_
),
high = case_when(
base %in% has_low_high & !is.na( get(paste0(base, "high")) ) ~ get(paste0(base, "high")),
TRUE ~ NA_real_
)
)
rlang::last_trace()
# First: Identify the base (remove low/high suffix if present)
HalFSAR2 <- HalFSAR %>%
mutate(
base = str_replace(ts.name, "(low|high)$", "")
)
# For each panel.category/year/base, find low/high values (from other rows)
HalFSAR2 <- HalFSAR2 %>%
group_by(panel.category, year, base) %>%
mutate(
low = if_else(
base %in% bases_with_bounds,
ts.value[ts.name == paste0(base, "low")][1],  # get the value, or NA if not present
NA_real_
),
high = if_else(
base %in% bases_with_bounds,
ts.value[ts.name == paste0(base, "high")][1],
NA_real_
)
) %>%
ungroup()
library(dplyr)
library(tidyr)
library(stringr)
bases_with_bounds <- c("HSpred", "HSproj", "Ut", "Mt")
# Step 1: Add a 'base' column that strips "low" or "high" suffix
HalFSAR2 <- HalFSAR %>%
mutate(
base = str_replace(ts.name, "(low|high)$", "")
)
# Step 2: For groups, find the value that matches base + "low" and base + "high"
HalFSAR2 <- HalFSAR2 %>%
group_by(panel.category, year, base) %>%
mutate(
low  = if (base[1] %in% bases_with_bounds) ts.value[ts.name == paste0(base[1], "low")][1] else NA_real_,
high = if (base[1] %in% bases_with_bounds) ts.value[ts.name == paste0(base[1], "high")][1] else NA_real_
) %>%
ungroup()
# See result
HalFSAR2 %>% select(panel.category, year, ts.name, ts.value, low, high)
unique(HalFSAR2$ts.name)
View(HalFSAR2)
HalFSAR <- readRDS("C:/Users/mcmahonm/Downloads/HalFSAR.rds")
library(dplyr)
library(tidyr)
library(stringr)
bases_with_bounds <- c("HSpred", "HSproj", "Ut", "Mt")
# Step 1: Add a 'base' column that strips "low" or "high" suffix
HalFSAR2 <- HalFSAR %>%
mutate(
base = str_replace(ts.name, "(low|high)$", "")
)
# Step 2: For groups, find the value that matches base + "low" and base + "high"
HalFSAR2 <- HalFSAR2 %>%
group_by(panel.category, year, base) %>%
mutate(
low  = if (base[1] %in% bases_with_bounds) ts.value[ts.name == paste0(base[1], "low")][1] else NA_real_,
high = if (base[1] %in% bases_with_bounds) ts.value[ts.name == paste0(base[1], "high")][1] else NA_real_
) %>%
ungroup()
head(HalFSAR2 )
HalFSAR2 |> View()
unique(HalFSAR2$ts.value)
unique(HalFSAR2$ts.name)
bases_with_bounds <- c("HSpred", "HSproj", "Ut", "Mt", "RVpred")
# Strip possible suffix from ts.name
HalFSAR2 <- HalFSAR %>%
mutate(
base = str_replace(ts.name, "(low|high)$", "")
)
# For each panel.category/year/base, find low/high values
HalFSAR_aug <- HalFSAR2 %>%
group_by(panel.category, year, base) %>%
mutate(
low  = if (base[1] %in% bases_with_bounds) ts.value[ts.name == paste0(base[1], "low")][1] else NA_real_,
high = if (base[1] %in% bases_with_bounds) ts.value[ts.name == paste0(base[1], "high")][1] else NA_real_
) %>%
ungroup()
HalFSAR_final <- HalFSAR_aug %>%
filter(ts.name == base) %>%
select(panel.category, year, ts.name, ts.value, low, high)
HalFSAR_final |> View()
HalFSAR <- HalFSAR_aug %>%
filter(ts.name == base) %>%
select(panel.category, year, ts.name, ts.value, low, high)
names(HalFSAR)
fsar_halibut<-ea_data(
data=HalFSAR,
value_col="ts.value",
data_type= "stock",
location_descriptor = "NAFO3nops4vswx5zc",
region = "Maritimes",
units="variable")
head(fsar_halibut)
unique(fsar_halibut@data$ts.name)
View(HalFSAR)
test <- fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSpred"]
plot(test)
class(test)
plot(test, style="ribbon")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSpred"], style="ribbon")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Ut"], style="ribbon")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Recruitment" & fsar_halibut@data$ts.name=="RVPred"], style="ribbon")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Recruitment" & fsar_halibut@data$ts.name=="RVpred"], style="ribbon")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
HalFSAR <- readRDS("C:/Users/mcmahonm/Downloads/HalFSAR.rds")
library(dplyr)
library(tidyr)
library(stringr)
bases_with_bounds <- c("HSpred", "HSproj", "Ut", "Mt", "RVpred")
# Strip possible suffix from ts.name
HalFSAR2 <- HalFSAR %>%
mutate(
base = str_replace(ts.name, "(low|high)$", "")
)
# For each panel.category/year/base, find low/high values
HalFSAR_aug <- HalFSAR2 %>%
group_by(panel.category, year, base) %>%
mutate(
low  = if (base[1] %in% bases_with_bounds) ts.value[ts.name == paste0(base[1], "low")][1] else NA_real_,
high = if (base[1] %in% bases_with_bounds) ts.value[ts.name == paste0(base[1], "high")][1] else NA_real_
) %>%
ungroup()
# Now keep only the main (non-low/non-high) rows
# The main names are: base values (not ending in low/high)
HalFSAR <- HalFSAR_aug %>%
filter(ts.name == base) %>%
select(panel.category, year, ts.name, ts.value, low, high)
fsar_halibut<-ea_data(
data=HalFSAR,
value_col="ts.value",
data_type= "stock",
location_descriptor = "NAFO3nops4vswx5zc",
region = "Maritimes",
units="variable")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
HalFSAR_raw<- readRDS("C:\git\MarEcosystemApproaches\marea\data-raw\fsar-halibut/HalFSAR_raw.rds")
HalFSAR_raw<- readRDS("C:/git/MarEcosystemApproaches/marea/data-raw/fsar-halibut/HalFSAR_raw.rds")
library(dplyr)
library(tidyr)
library(stringr)
bases_with_bounds <- c("HSpred", "HSproj", "Ut", "Mt", "RVpred")
HalFSAR2 <- HalFSAR %>%
mutate(
base = str_replace(ts.name, "(low|high)$", "")
)
cleantheGarbage()
HalFSAR_raw<- readRDS("C:/git/MarEcosystemApproaches/marea/data-raw/fsar-halibut/HalFSAR_raw.rds")
library(dplyr)
library(tidyr)
library(stringr)
bases_with_bounds <- c("HSpred", "HSproj", "Ut", "Mt", "RVpred")
HalFSAR2 <- HalFSAR_raw %>%
mutate(
base = str_replace(ts.name, "(low|high)$", "")
)
# For each panel.category/year/base, find low/high values
HalFSAR_aug <- HalFSAR2 %>%
group_by(panel.category, year, base) %>%
mutate(
low  = if (base[1] %in% bases_with_bounds) ts.value[ts.name == paste0(base[1], "low")][1] else NA_real_,
high = if (base[1] %in% bases_with_bounds) ts.value[ts.name == paste0(base[1], "high")][1] else NA_real_
) %>%
ungroup()
# Now keep only the main (non-low/non-high) rows
# The main names are: base values (not ending in low/high)
HalFSAR <- HalFSAR_aug %>%
filter(ts.name == base) %>%
select(panel.category, year, ts.name, ts.value, low, high)
fsar_halibut<-ea_data(
data=HalFSAR,
value_col="ts.value",
data_type= "stock",
location_descriptor = "NAFO3nops4vswx5zc",
region = "Maritimes",
units="variable")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
usethis::use_data(fsar_halibut)
devtools::document()
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Ut"], style="ribbon")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Recruitment" & fsar_halibut@data$ts.name=="RVPred"], style="ribbon")
pkgload::dev_help('[[,ea_data-method')
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Ut"], style="ribbon")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon", main="Fishing:Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon", labs(title="Fishing:Mt"))
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
+ labs(title="Fishing:Mt"))
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
+ labs(title="Fishing:Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
+ labs(title="Fishing-Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
+ labs(title="Fishing-Mt")
library(ggplot2)
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
+ labs(title="Fishing-Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon") +
labs(title="Fishing-Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon") +
labs(title="Fishing:Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Ut"], style="ribbon") +
labs(title="Fishing:Ut")
fsar_halibut@data$ts.name |> distinct()
fsar_halibut@data$ts.name |> names() |> distinct()
unique(fsar_halibut@data$ts.name)
View(fsar_halibut)
View(fsar_halibut@data)
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon") +
labs(title="Fishing:Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Ut"], style="ribbon") +
labs(title="Fishing:Ut")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSPred"], style="ribbon") +
labs(title="Biomass:HSpred")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSProj"], style="ribbon") +
labs(title="Biomass:HSProj")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Recruitment" & fsar_halibut@data$ts.name=="RVpred"], style="ribbon") +
labs(title="Recruitment:RVpred")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSproj"], style="ribbon") +
labs(title="Biomass:HSProj")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon") +
labs(title="Fishing:Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Ut"], style="ribbon") +
labs(title="Fishing:Ut")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSPred"], style="ribbon") +
labs(title="Biomass:HSpred")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSproj"], style="ribbon") +
labs(title="Biomass:HSProj")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Recruitment" & fsar_halibut@data$ts.name=="RVpred"], style="ribbon") +
labs(title="Recruitment:RVpred")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon") +
labs(title="Fishing:Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Ut"], style="ribbon") +
labs(title="Fishing:Ut")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSpred"], style="ribbon") +
labs(title="Biomass:HSpred")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSproj"], style="ribbon") +
labs(title="Biomass:HSProj")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Recruitment" & fsar_halibut@data$ts.name=="RVpred"], style="ribbon") +
labs(title="Recruitment:RVpred")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon") +
+   labs(title="Fishing:Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
devtools::load_all()
library(Mar.datawrangling)
get_data('marfis')
View(SPECIES)
str(PRO_SPC_INFO)
library(dplyr)
library(tidyr)
library(lubridate)
# Prepare LANDED_DATE summary (ignore NAs)
by_landed <- PRO_SPC_INFO %>%
filter(SPECIES_CODE == 700, !is.na(RND_WEIGHT_KGS), !is.na(LANDED_DATE)) %>%
mutate(year = year(LANDED_DATE)) %>%
group_by(year) %>%
summarize(wt_by_LANDED_DATE = sum(RND_WEIGHT_KGS), .groups = "drop")
# Prepare DATE_FISHED summary (ignore NAs)
by_fished <- PRO_SPC_INFO %>%
filter(SPECIES_CODE == 700, !is.na(RND_WEIGHT_KGS), !is.na(DATE_FISHED)) %>%
mutate(year = year(DATE_FISHED)) %>%
group_by(year) %>%
summarize(wt_by_DATE_FISHED = sum(RND_WEIGHT_KGS), .groups = "drop")
# Combine both summaries by full join, so all years in either set are included
result <- full_join(by_landed, by_fished, by = "year") %>%
arrange(year)
print(result)
print(tail(result))
devtools::load_all()
devtools::load_all()
plot(fsar_halibut)
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")
+   labs(title="Fishing:Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Mt"], style="ribbon")   +   labs(title="Fishing:Mt")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Fishing" & fsar_halibut@data$ts.name=="Ut"], style="ribbon")   +   labs(title="Fishing:Ut")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSpred"], style="ribbon")   +   labs(title="Biomass:HSpred")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Biomass" & fsar_halibut@data$ts.name=="HSproj"], style="ribbon")   +   labs(title="Biomass:HSProj")
plot(fsar_halibut[fsar_halibut@data$panel.category=="Recruitment" & fsar_halibut@data$ts.name=="RVpred"], style="ribbon")   +   labs(title="Recruitment:RVpred")
